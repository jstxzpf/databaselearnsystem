**程序设计方案：基于Tkinter的学习软件**

**1. 模块导入与初始化**

* 导入必要的Python模块：`tkinter` (GUI), `json` (处理JSON数据), `requests` (与Ollama API交互), `tkinter.filedialog` (文件对话框), `tkinter.messagebox` (消息框), `tkinter.ttk` (美化组件，可选).
* 定义全局变量或类属性，用于存储加载的 `knowlegebase.json` 和 `testmodel.json` 数据。
* 定义Ollama API的基础URL和模型名称（`gemma3:27b`）。

**2. 主窗口类 (Application Class)**

* 创建一个名为 `LearningApp` 的类，继承自 `tkinter.Tk`。
* 在 `__init__` 方法中：
    * 调用父类的 `__init__` 方法初始化主窗口。
    * 设置窗口标题。
    * 调用 `load_data()` 方法加载 JSON 数据。
    * 调用 `init_ui()` 方法初始化用户界面。
    * 初始化与本地 Ollama API 的连接（可以简单地存储 API 的 URL 和模型名称）。

**3. 数据加载方法 (`load_data`)**

* 尝试打开并读取 `knowlegebase.json` 文件。
* 如果文件存在，将数据存储到相应的变量中（例如，`self.knowledge_base_data`）。提取科目名称并显示在窗口左上角。
* 如果文件不存在，显示错误消息并退出程序或提供默认数据。
* 同样的方式处理 `testmodel.json` 文件，存储到另一个变量（例如，`self.test_model_data`）。

**4. 用户界面初始化方法 (`init_ui`)**

* 使用 `tkinter.Notebook` 创建选项卡控件，包含 "学习", "考试", "审批试卷" 三个标签页。
* **学习标签页布局：**
    * 创建一个 `tkinter.Frame` 作为学习标签页的内容。
    * 在左侧第一列创建一个 `tkinter.Listbox` 用于显示章节名称。
        * 从 `self.knowledge_base_data` 中提取章节名称并插入到列表框中。
        * 为列表框绑定选择事件，当用户选择章节时，触发一个方法来更新第二列的内容。
    * 在左侧第二列创建一个 `tkinter.Listbox` 用于显示选中章节的主要概念和主要知识点。
        * 该列表框的内容会根据第一列的选择动态更新。
    * 在右侧区域创建一个或多个 `tkinter.Text` 或 `tkinter.Label` 组件，用于显示AI对主要概念和主要知识点的讲解。
    * 可以添加一个按钮或通过双击列表框条目的方式触发AI讲解。
* **考试标签页布局：**
    * 创建一个 `tkinter.Frame` 作为考试标签页的内容。
    * 在左侧创建一个 `tkinter.Listbox` 用于显示章节名称，允许用户进行多选。
    * 创建一个按钮，当用户点击时，触发考试试卷生成的方法。
    * 可以添加选项设置考试的参数（例如，题目数量，可选）。
* **审批试卷标签页布局：**
    * 创建一个 `tkinter.Frame` 作为审批试卷标签页的内容。
    * 创建一个按钮，用于打开文件对话框，让用户选择要导入的TXT试卷文件。
    * 创建一个文本区域 (`tkinter.Text`) 用于显示批改结果和学习建议。
    * 创建一个按钮，用于触发试卷审批的方法。

**5. 学习功能实现 (`start_learning`)**

* 当用户在学习标签页选择一个章节时，更新第二个列表框，显示该章节的 `mainConcepts` 和 `mainContents`。
* 当用户选择一个主要概念或主要知识点并触发学习操作时：
    * 判断用户选择的是概念还是知识点。
    * 构建发送给 Ollama API 的提示 (prompt)。
        * 对于主要概念，提示应要求提供定义和示例。
        * 对于主要知识点，提示应要求提供定义、实际举例和代码示例。
    * 使用 `requests` 库向本地 Ollama API 发送 POST 请求。
    * 处理 API 的响应，提取 AI 的讲解内容。
    * 将讲解内容显示在学习标签页的右侧区域。

**6. 考试功能实现 (`generate_exam`)**

* 当用户在考试标签页选择章节并点击生成考试按钮时：
    * 获取用户选择的章节列表。
    * 遍历 `self.test_model_data` 中的 "题型列表"。
    * 对于每种题型，根据 `考查重点` 和 `内容范围`，构建发送给 Ollama API 的提示。提示应明确要求生成指定数量的该类型题目，并限定在用户选择的章节范围内。
    * 使用 `requests` 库向本地 Ollama API 发送请求，获取生成的试题。
    * 将不同题型的试题组合成一个完整的试卷。
    * 使用 `tkinter.filedialog.asksaveasfilename` 允许用户选择保存试卷的路径和文件名（默认为TXT格式）。
    * 将生成的试卷内容写入到用户指定的文件中。
    * 可以显示一个消息框提示用户试卷已成功导出。

**7. 审批试卷功能实现 (`review_exam`)**

* 当用户在审批试卷标签页点击导入试卷按钮时，使用 `tkinter.filedialog.askopenfilename` 获取用户选择的TXT试卷文件路径。
* 读取导入的试卷文件内容。
* 当用户点击审批试卷按钮时：
    * 解析试卷内容，提取每个问题的用户答案。这需要假设试卷有一定的格式。
    * 遍历试卷中的每个问题。
    * 根据问题的内容和用户答案，以及 `knowlegebase.json` 中相关章节的内容，构建发送给 Ollama API 的提示，要求其对答案进行批改。
    * 使用 `requests` 库向本地 Ollama API 发送请求，获取批改结果。
    * 根据批改结果和 `knowlegebase.json` 的内容，分析用户对哪些主要概念和主要知识点已经掌握，哪些需要加强学习。
    * 将批改结果和学习建议格式化后显示在审批试卷标签页的文本区域。

**8. 主程序运行**

* 在脚本的最后，创建 `LearningApp` 类的实例并运行 `mainloop()` 方法，启动 Tkinter 应用程序。

**流程总结：**

1.  **初始化：** 程序启动，加载配置文件，初始化UI界面，显示章节列表。
2.  **学习：** 用户选择章节，查看概念和知识点，选择要学习的内容，程序调用AI接口获取讲解并显示。
3.  **考试：** 用户选择要考试的章节，点击生成考试，程序根据题型配置调用AI接口生成试卷，并导出为TXT文件。
4.  **审批试卷：** 用户导入TXT试卷，点击审批，程序调用AI接口批改试卷，并根据知识库分析用户的掌握情况，给出反馈。
